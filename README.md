# Интеграционные тесты
Для запуска интеграционных тестов используется `docker-compose.tests.yaml` файл с БД и тесты из `tests/integration`

Команды запуска:
```sh
./run_integration_tests.sh

# Либо же можно запустить в несколько команд
# Старт тестовой БД
docker compose -f docker-compose.tests.yaml up --build -d --wait
# Запуск тестов
go test ./tests/integration
# Остановить тестовую БД
docker compose -f docker-compose.tests.yaml down -v
```

# Выбранные решения
## Собственная библиотека для цепочки хендлеров
В проекте использована моя библиотека [stackable](https://pkg.go.dev/github.com/saryginrodion/stackable) для цепочки хендлеров реквестов (работает как некий аналог `express.js`)

Небольшой экскурс в нее:
- Есть цепочка хендлеров (структура `Stackable`). Она реализует интерфейс `Handler` из `net/http`.
- `SharedState` - общее состояние (сохраняется между реквестами).
- `LocalState` - состояние для одного реквеста (с помощью него хендлеры могут передавать данные в цепочке в рамках одного реквеста)
- `Handler` - интерфейс одного хэндлера в цепочке. В него передается `Context` - там лежит `response`, `request`, `SharedState` и `LocalState`, а также функция `next() error` - для вызова следующего хендлера

Цепочка начинается с первого добавленного хендлера и идет до последнего путем вызовов `next()`

## Дополнительная ошибка: USER_EXISTS_IN_ANOTHER_TEAM
Означает, что id одного из пользователя, добавляемого с созданием новой команды уже используется.

## Ограничение: невозможность обновлять состав команды
В приложенном `openapi` есть эндпоинт `/team/add`, который якобы должен использоваться также и для обновления команды (так написано в его описании),
но также в ошибках этого эндпоинта есть `TEAM_EXISTS` код, который показывает, что **команда уже создана**.

Также возможность обновить пользователей именно в такой архитектуре API нелогична - для каждой команды создаются отдельные пользователи, которые привязаны
только к одной команде.

Поэтому для переопределения состава команды ее нужно **создать заново**. Это связано с ограничениями данного API.
